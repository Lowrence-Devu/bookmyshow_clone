{% extends "admin/base_site.html" %}
{% load i18n %}

{% block title %}Admin Dashboard | BookMySeat{% endblock %}

{% block extrahead %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
{% endblock %}

{% block breadcrumbs %}
<div class="breadcrumbs">
  <a href="{% url 'admin:index' %}">Home</a> &rsaquo; Dashboard
</div>
{% endblock %}

{% block content %}
<div class="dashboard-container">
  <h1>Admin Dashboard</h1>

  <div class="dashboard-cards">
    <div class="card revenue-card">
      <div class="card-body">
        <h5><i class="fas fa-rupee-sign"></i> Total Revenue</h5>
        <p class="stat-value">₹{{ total_revenue|floatformat:2 }}</p>
      </div>
    </div>
  </div>

  <div class="row dashboard-section">
    <div class="col-md-6">
      <h3>Most Popular Movies</h3>
      <table class="table table-striped">
        <thead>
          <tr><th>Movie</th><th>Bookings</th></tr>
        </thead>
        <tbody>
          {% for movie in popular_movies %}
          <tr>
            <td>{{ movie.name }}</td>
            <td>{{ movie.booking_count }}</td>
          </tr>
          {% empty %}
          <tr><td colspan="2">No data yet</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    <div class="col-md-6">
      <h3>Busiest Theaters</h3>
      <table class="table table-striped">
        <thead>
          <tr><th>Theater</th><th>Bookings</th></tr>
        </thead>
        <tbody>
          {% for theater in busiest_theaters %}
          <tr>
            <td>{{ theater.name }} ({{ theater.movie.name }})</td>
            <td>{{ theater.booking_count }}</td>
          </tr>
          {% empty %}
          <tr><td colspan="2">No data yet</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <div class="dashboard-section">
    <h3>Recent Bookings</h3>
    <table class="table table-striped">
      <thead>
        <tr>
          <th>User</th>
          <th>Movie</th>
          <th>Theater</th>
          <th>Seat</th>
          <th>Amount</th>
          <th>Date</th>
        </tr>
      </thead>
      <tbody>
        {% for b in recent_bookings %}
        <tr>
          <td>{{ b.user.username }}</td>
          <td>{{ b.movie.name }}</td>
          <td>{{ b.theater.name }}</td>
          <td>{{ b.seat.seat_number }}</td>
          <td>₹{{ b.amount }}</td>
          <td>{{ b.booked_at|date:"M d, Y H:i" }}</td>
        </tr>
        {% empty %}
        <tr><td colspan="6">No bookings yet</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<style>
  .dashboard-container { padding: 20px; max-width: 1200px; }
  .dashboard-cards { display: flex; gap: 20px; margin-bottom: 30px; flex-wrap: wrap; }
  .revenue-card { min-width: 250px; background: linear-gradient(135deg, #28a745, #20c997); color: white; }
  .stat-value { font-size: 2rem; font-weight: bold; margin: 0; }
  .dashboard-section { margin-bottom: 30px; }
  @media (max-width: 768px) {
    .dashboard-cards { flex-direction: column; }
    .table { font-size: 0.9rem; overflow-x: auto; display: block; }
  }
</style>
{% endblock %}
